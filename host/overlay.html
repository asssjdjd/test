<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" 
          content="script-src 'self' 'unsafe-inline' https://cdn.socket.io; 
                   connect-src 'self' https: wss: http://localhost:* ws://localhost:* https://cdn.socket.io;">
    <title>Agent</title>
</head>
<body>
    <h4 id="status">Đang khởi động...</h4>
    <button id="disconnectBtn">Disconnect & Quit</button>

    <!-- Load Socket.IO trước -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
    <!-- Đợi preload load xong rồi mới load hostRenderer.js -->
    <script>
        window.addEventListener('load', () => {
            console.log('[overlay] Window loaded');
            
            // Đợi thêm 200ms để chắc chắn preload đã expose API
            setTimeout(() => {
                console.log('[overlay] Checking electronAPI:', window.electronAPI);
                
                if (!window.electronAPI) {
                    console.error('[overlay] ❌ electronAPI KHÔNG TỒN TẠI!');
                    document.getElementById('status').textContent = 'LỖI: Preload failed';
                    return;
                }
                
                console.log('[overlay] ✅ electronAPI OK, loading hostRenderer.js...');
                const script = document.createElement('script');
                script.src = 'hostRenderer.js';
                script.onerror = () => {
                    console.error('[overlay] ❌ Không load được hostRenderer.js');
                    document.getElementById('status').textContent = 'LỖI: Script load failed';
                };
                document.body.appendChild(script);
            }, 200);
        });
    </script>
</body>
</html>